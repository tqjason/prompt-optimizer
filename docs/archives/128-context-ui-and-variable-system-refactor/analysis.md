# ğŸ“± ä¸Šä¸‹æ–‡æ¨¡å¼é‡æ„ - UI è®¾è®¡åˆ†ææŠ¥å‘Š

> **æ–‡æ¡£ç‰ˆæœ¬**: v2.0  
> **åˆ›å»ºæ—¥æœŸ**: 2025-10-21  
> **æœ€åæ›´æ–°**: 2025-10-22  
> **åˆ†æèŒƒå›´**: ä¸Šä¸‹æ–‡æ¨¡å¼ (User/System) UI ç»„ä»¶è®¾è®¡ + å˜é‡ç³»ç»Ÿé‡æ„  
> **çŠ¶æ€**: âœ… v1.1æ”¹é€ å·²å®Œæˆï¼ŒğŸ“‹ v2.0å˜é‡ç³»ç»Ÿé‡æ„å¾…å®æ–½

---

## ğŸ“¢ é‡è¦æ›´æ–°

### âœ… v1.1 UIæ”¹é€  (å·²å®Œæˆ - 2025-10-22)

1. **å­æ¨¡å¼é€‰æ‹©å™¨ä½ç½®è°ƒæ•´** âœ… å·²å®Œæˆ
   - **é—®é¢˜**: å­æ¨¡å¼é€‰æ‹©å™¨ä½äºå·¥ä½œåŒºå†…ï¼Œå±‚çº§æ··ä¹±
   - **æ–¹æ¡ˆ**: ç§»åŠ¨åˆ°å¯¼èˆªæ ï¼Œç´§é‚»åŠŸèƒ½æ¨¡å¼é€‰æ‹©å™¨å³ä¾§
   - **çŠ¶æ€**: âœ… å·²å®Œæˆ
   - **æäº¤**: ä¹‹å‰å·²å®Œæˆ

2. **å¿«æ·æ“ä½œæ ä½ç½®è°ƒæ•´** âœ… å·²å®Œæˆ
   - **é—®é¢˜**: å¿«æ·æ“ä½œæ åœ¨å·¦ä¾§ä¼˜åŒ–åŒºï¼Œä½œç”¨åŸŸä¸æ˜ç¡®
   - **æ–¹æ¡ˆ**: ç§»åŠ¨åˆ°å³ä¾§æµ‹è¯•åŒºé¡¶éƒ¨ï¼Œè´´è¿‘ä½¿ç”¨åœºæ™¯
   - **çŠ¶æ€**: âœ… å·²å®Œæˆ
   - **æäº¤**: `ce90d47` - refactor(ui): ä¼˜åŒ–ä¸Šä¸‹æ–‡æ¨¡å¼å¿«æ·æ“ä½œæ ä½ç½®

### ğŸ“‹ v2.0 å˜é‡ç³»ç»Ÿé‡æ„ (å¾…å®æ–½)

3. **å˜é‡ç³»ç»Ÿç®€åŒ–** ğŸ”´ é«˜ä¼˜å…ˆçº§
   - **é—®é¢˜**: "å…¨å±€å˜é‡"å’Œ"ä¼šè¯å˜é‡"æ¦‚å¿µæ··æ·†ï¼Œå®é™…éƒ½æ˜¯æŒä¹…åŒ–å˜é‡
   - **æ–¹æ¡ˆ**: ç§»é™¤ä¼šè¯å˜é‡ï¼Œå¼•å…¥æµ‹è¯•åŒºä¸´æ—¶å˜é‡
   - **çŠ¶æ€**: âœ… å·²å®Œæˆï¼ˆä½œä¸ºå½’æ¡£è®°å½•ï¼‰
   - **è¯¦æƒ…**: è§ [å˜é‡ç³»ç»Ÿé‡æ„è®¾è®¡æ–‡æ¡£](./design.md)

### ğŸ“Š æ”¹é€ é¢„æœŸæ•ˆæœ

**æ”¹é€ å‰:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Prompt Optimizer | [åŸºç¡€|ä¸Šä¸‹æ–‡|å›¾åƒ] | ğŸ“ğŸ“œâš™ï¸...     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [ğŸ“ŠğŸ“ğŸ”§]              â”‚ æµ‹è¯•åŒº                         â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚                               â”‚
â”‚ [ç³»ç»Ÿ|ç”¨æˆ·] [æ¨¡å‹â–¾]    â”‚                               â”‚
â”‚ è¾“å…¥æ¡†...              â”‚                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â†‘ é—®é¢˜1: å±‚çº§æ··ä¹±         â†‘ é—®é¢˜2: æ“ä½œè·ç¦»è¿œ
```

**æ”¹é€ å:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Prompt Optimizer                                       â”‚
â”‚ [åŸºç¡€|ä¸Šä¸‹æ–‡|å›¾åƒ] [ç³»ç»Ÿ|ç”¨æˆ·] ğŸ“ğŸ“œâš™ï¸...              â”‚
â”‚    â†‘ åŠŸèƒ½æ¨¡å¼           â†‘ å­æ¨¡å¼ï¼ˆåŠ¨æ€æ˜¾ç¤ºï¼‰           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ä¼˜åŒ–åŒº                 â”‚ æµ‹è¯•åŒº                         â”‚
â”‚                        â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ [æ¨¡å‹â–¾] [æ¨¡æ¿â–¾]       â”‚ â”‚ æµ‹è¯• ğŸ“Šå…¨å±€ ğŸ“ä¼šè¯ ğŸ”§å·¥å…· â”‚ â”‚
â”‚ è¾“å…¥æ¡†...              â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚ (ç©ºé—´å¢åŠ )             â”‚ å˜é‡è¾“å…¥...                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ”¹è¿›æ•ˆæœ:**
- âœ… å±‚çº§æ¸…æ™°ï¼šåŠŸèƒ½æ¨¡å¼å’Œå­æ¨¡å¼åœ¨åŒä¸€å¯¼èˆªæ 
- âœ… ä½œç”¨åŸŸæ˜ç¡®ï¼šå¿«æ·æ“ä½œæ åœ¨æµ‹è¯•åŒºï¼Œè´´è¿‘ä½¿ç”¨åœºæ™¯
- âœ… ç©ºé—´ä¼˜åŒ–ï¼šä¼˜åŒ–åŒºå‚ç›´ç©ºé—´å¢åŠ 
- âœ… æ“ä½œä¾¿æ·ï¼šæµ‹è¯•æ—¶è®¾ç½®å˜é‡ï¼Œæ“ä½œè·¯å¾„æœ€çŸ­

---

## ä¸€ã€æ•´ä½“æ¶æ„è®¾è®¡

### 1.1 ç»„ä»¶å±‚æ¬¡ç»“æ„

```
App.vue (ä¸»åº”ç”¨)
â”œâ”€â”€ ContextUserWorkspace.vue (ç”¨æˆ·æ¨¡å¼å·¥ä½œåŒº)
â”‚   â”œâ”€â”€ ContextModeActions (å¿«æ·æ“ä½œæŒ‰é’®)
â”‚   â”œâ”€â”€ InputPanelUI (æç¤ºè¯è¾“å…¥)
â”‚   â”œâ”€â”€ PromptPanelUI (ä¼˜åŒ–ç»“æœ)
â”‚   â””â”€â”€ TestAreaPanel (æµ‹è¯•åŒºåŸŸ)
â”‚
â””â”€â”€ ContextSystemWorkspace.vue (ç³»ç»Ÿæ¨¡å¼å·¥ä½œåŒº)
    â”œâ”€â”€ ContextModeActions (å¿«æ·æ“ä½œæŒ‰é’®)
    â”œâ”€â”€ InputPanelUI (æç¤ºè¯è¾“å…¥)
    â”œâ”€â”€ ConversationManager (ä¼šè¯ç®¡ç†å™¨) â† ç³»ç»Ÿæ¨¡å¼ä¸“å±
    â”œâ”€â”€ PromptPanelUI (ä¼˜åŒ–ç»“æœ)
    â””â”€â”€ TestAreaPanel (æµ‹è¯•åŒºåŸŸ)

å…±äº«ç»„ä»¶:
â”œâ”€â”€ ContextEditor.vue (ä¸Šä¸‹æ–‡ç¼–è¾‘å™¨ - æ¨¡æ€æ¡†)
â”œâ”€â”€ PromptPreviewPanel.vue (é¢„è§ˆé¢æ¿ - æ¨¡æ€æ¡†)
â””â”€â”€ TestAreaPanel.vue (æµ‹è¯•åŒºåŸŸ - å¤ç”¨)
```

**ç»„ä»¶æ–‡ä»¶ä½ç½®:**
```
packages/ui/src/components/
â”œâ”€â”€ context-mode/
â”‚   â”œâ”€â”€ ContextUserWorkspace.vue
â”‚   â”œâ”€â”€ ContextSystemWorkspace.vue
â”‚   â”œâ”€â”€ ContextModeActions.vue
â”‚   â”œâ”€â”€ ContextEditor.vue
â”‚   â””â”€â”€ ConversationManager.vue
â”œâ”€â”€ PromptPreviewPanel.vue
â”œâ”€â”€ TestAreaPanel.vue
â”œâ”€â”€ InputPanel.vue
â””â”€â”€ PromptPanel.vue

packages/ui/src/composables/
â””â”€â”€ usePromptPreview.ts
```

### 1.2 è®¾è®¡æ¨¡å¼

âœ… **é‡‡ç”¨äº†ä¼˜ç§€çš„è®¾è®¡æ¨¡å¼:**

1. **ç»„åˆä¼˜äºç»§æ‰¿**
   - User/System Workspace æ˜¯ç‹¬ç«‹ç»„ä»¶è€Œéç»§æ‰¿
   - é¿å…äº†å¤æ‚çš„ if-else æ¡ä»¶åˆ¤æ–­

2. **Props å•å‘æ•°æ®æµ**
   - æ‰€æœ‰æ•°æ®é€šè¿‡ props ä¼ å…¥
   - é€šè¿‡ emit è§¦å‘çˆ¶ç»„ä»¶æ›´æ–°
   - éµå¾ª Vue 3 æœ€ä½³å®è·µ

3. **Composable é€»è¾‘å¤ç”¨**
   - `usePromptPreview` æä¾›å¯å¤ç”¨çš„é¢„è§ˆé€»è¾‘
   - åˆ†ç¦» UI å’Œä¸šåŠ¡é€»è¾‘

4. **Slot æ’æ§½æ‰©å±•**
   - æ¨¡å‹é€‰æ‹©ã€ç»“æœæ˜¾ç¤ºç­‰ä½¿ç”¨æ’æ§½å®ç°çµæ´»æ€§
   - æ”¯æŒä¸åŒåœºæ™¯çš„è‡ªå®šä¹‰æ¸²æŸ“

---

## äºŒã€ä¸¤ç§æ¨¡å¼çš„ UI å·®å¼‚

### 2.1 ç”¨æˆ·æ¨¡å¼ (User Mode)

**æ–‡ä»¶**: `packages/ui/src/components/context-mode/ContextUserWorkspace.vue`

**å¸ƒå±€ç»“æ„:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“Š å…¨å±€å˜é‡  ğŸ“ ä¼šè¯å˜é‡  ğŸ”§ å·¥å…·ç®¡ç†               â”‚ â† å¿«æ·æ“ä½œ
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å·¦ä¾§ä¼˜åŒ–åŒº                â”‚ å³ä¾§æµ‹è¯•åŒº              â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚ â”‚ æç¤ºè¯è¾“å…¥é¢æ¿       â”‚  â”‚ â”‚ å˜é‡å€¼è¾“å…¥è¡¨å•       â”‚â”‚
â”‚ â”‚ "å†™ä¸€é¦–{{style}}çš„æ­Œ"â”‚  â”‚ â”‚ style: [æ¬¢å¿«____]   â”‚â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚ â”‚ ä¼˜åŒ–ç»“æœé¢æ¿         â”‚  â”‚ â”‚ é¢„è§ˆå†…å®¹             â”‚â”‚
â”‚ â”‚ "è¯·åˆ›ä½œä¸€é¦–é£æ ¼ä¸º    â”‚  â”‚ â”‚ "è¯·åˆ›ä½œä¸€é¦–é£æ ¼ä¸º    â”‚â”‚
â”‚ â”‚  {{style}}çš„æ­Œ..."  â”‚  â”‚ â”‚  æ¬¢å¿«çš„æ­Œ..."       â”‚â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                          â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚                          â”‚ â”‚ æµ‹è¯•ç»“æœ             â”‚â”‚
â”‚                          â”‚ â”‚ (LLM å“åº”)          â”‚â”‚
â”‚                          â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ ¸å¿ƒç‰¹ç‚¹:**
- âŒ **éšè—** ä¼šè¯æ¶ˆæ¯åˆ—è¡¨ç®¡ç†
- âœ… **æ˜¾ç¤º** å·¥å…·ç®¡ç†æŒ‰é’®
- âœ… å•æ¡ç”¨æˆ·æ¶ˆæ¯ä¼˜åŒ–
- âœ… ä¸¤é˜¶æ®µå˜é‡å¤„ç†ï¼ˆä¼˜åŒ–ä¿ç•™ â†’ æµ‹è¯•æ›¿æ¢ï¼‰
- âœ… æ— éœ€è¾“å…¥æµ‹è¯•é—®é¢˜ï¼ˆæç¤ºè¯å³æµ‹è¯•å†…å®¹ï¼‰

**ä»£ç ç‰¹å¾:**
```vue
<!-- ç”¨æˆ·æ¨¡å¼å·¥ä½œåŒºæ ¸å¿ƒç»“æ„ -->
<template>
  <NFlex justify="space-between">
    <!-- å·¦ä¾§ä¼˜åŒ–åŒº -->
    <NFlex vertical>
      <!-- å¿«æ·æ“ä½œ (åŒ…å«å·¥å…·ç®¡ç†æŒ‰é’®) -->
      <NCard>
        <NButton @click="emit('open-global-variables')">ğŸ“Š</NButton>
        <NButton @click="emit('open-context-variables')">ğŸ“</NButton>
        <NButton @click="emit('open-tool-manager')">ğŸ”§</NButton>
      </NCard>
      
      <!-- æç¤ºè¯è¾“å…¥ -->
      <NCard><InputPanelUI /></NCard>
      
      <!-- æ— ä¼šè¯ç®¡ç†å™¨ -->
      
      <!-- ä¼˜åŒ–ç»“æœ -->
      <NCard><PromptPanelUI /></NCard>
    </NFlex>
    
    <!-- å³ä¾§æµ‹è¯•åŒº -->
    <NCard>
      <TestAreaPanel 
        context-mode="user"
        :optimized-prompt="optimizedPrompt"
        :global-variables="globalVariables"
        :context-variables="contextVariables" />
    </NCard>
  </NFlex>
</template>
```

### 2.2 ç³»ç»Ÿæ¨¡å¼ (System Mode)

**æ–‡ä»¶**: `packages/ui/src/components/context-mode/ContextSystemWorkspace.vue`

**å¸ƒå±€ç»“æ„:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“Š å…¨å±€å˜é‡  ğŸ“ ä¼šè¯å˜é‡                             â”‚ â† å¿«æ·æ“ä½œ
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å·¦ä¾§ä¼˜åŒ–åŒº                â”‚ å³ä¾§æµ‹è¯•åŒº              â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚ â”‚ æç¤ºè¯è¾“å…¥é¢æ¿       â”‚  â”‚ â”‚ å˜é‡å€¼è¾“å…¥è¡¨å•       â”‚â”‚
â”‚ â”‚ "ä¼˜åŒ–ä»¥ä¸‹å¯¹è¯..."   â”‚  â”‚ â”‚ style: [æ¬¢å¿«____]   â”‚â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚ â”‚ ä¼šè¯ç®¡ç†å™¨ [æŠ˜å ]   â”‚  â”‚ â”‚ æµ‹è¯•è¾“å…¥ (ç”¨æˆ·é—®é¢˜) â”‚â”‚
â”‚ â”‚ â€¢ system: ä½ æ˜¯...   â”‚  â”‚ â”‚ "è¯·ç”Ÿæˆä¸€é¦–æ¬¢å¿«çš„æ­Œ" â”‚â”‚
â”‚ â”‚ â€¢ user: {{style}}   â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚ â”‚ â€¢ assistant: ...    â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚ â”‚ [æ‰“å¼€ä¸Šä¸‹æ–‡ç¼–è¾‘å™¨]  â”‚  â”‚ â”‚ é¢„è§ˆå†…å®¹             â”‚â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚ system: ä½ æ˜¯æ­Œæ›²åˆ›ä½œ â”‚â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚ user: æ¬¢å¿«          â”‚â”‚
â”‚ â”‚ ä¼˜åŒ–ç»“æœé¢æ¿         â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚ â”‚ (ä¼˜åŒ–åçš„å¯¹è¯ä¸Šä¸‹æ–‡) â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚ æµ‹è¯•ç»“æœ             â”‚â”‚
â”‚                          â”‚ â”‚ (LLM å“åº”)          â”‚â”‚
â”‚                          â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ ¸å¿ƒç‰¹ç‚¹:**
- âœ… **æ˜¾ç¤º** ä¼šè¯æ¶ˆæ¯ç®¡ç†å™¨ï¼ˆå¯æŠ˜å ï¼‰
- âŒ **éšè—** å·¥å…·ç®¡ç†æŒ‰é’®ï¼ˆç³»ç»Ÿæ¨¡å¼ä¸ç›´æ¥ç®¡ç†å·¥å…·ï¼‰
- âœ… å¤šæ¶ˆæ¯ä¸Šä¸‹æ–‡ç¼–è¾‘
- âœ… éœ€è¦é¢å¤–çš„æµ‹è¯•è¾“å…¥ (`userQuestion`)
- âœ… æ”¯æŒ system/user/assistant/tool å¤šç§è§’è‰²

**ä»£ç ç‰¹å¾:**
```vue
<!-- ç³»ç»Ÿæ¨¡å¼å·¥ä½œåŒºæ ¸å¿ƒç»“æ„ -->
<template>
  <NFlex justify="space-between">
    <!-- å·¦ä¾§ä¼˜åŒ–åŒº -->
    <NFlex vertical>
      <!-- å¿«æ·æ“ä½œ (æ— å·¥å…·ç®¡ç†æŒ‰é’®) -->
      <NCard>
        <NButton @click="emit('open-global-variables')">ğŸ“Š</NButton>
        <NButton @click="emit('open-context-variables')">ğŸ“</NButton>
      </NCard>
      
      <!-- æç¤ºè¯è¾“å…¥ -->
      <NCard><InputPanelUI /></NCard>
      
      <!-- ä¼šè¯ç®¡ç†å™¨ (ç³»ç»Ÿæ¨¡å¼ä¸“å±) -->
      <NCard>
        <ConversationManager
          :messages="optimizationContext"
          context-mode="system"
          @update:messages="emit('update:optimizationContext', $event)" />
      </NCard>
      
      <!-- ä¼˜åŒ–ç»“æœ -->
      <NCard><PromptPanelUI /></NCard>
    </NFlex>
    
    <!-- å³ä¾§æµ‹è¯•åŒº -->
    <NCard>
      <TestAreaPanel 
        context-mode="system"
        :test-content="testContent"
        :optimized-prompt="optimizedPrompt" />
    </NCard>
  </NFlex>
</template>
```

---

## ä¸‰ã€å…³é”®ç»„ä»¶æ·±åº¦åˆ†æ

### 3.1 `ContextModeActions.vue` - å¿«æ·æ“ä½œæ 

**æ–‡ä»¶**: `packages/ui/src/components/context-mode/ContextModeActions.vue`

**è®¾è®¡äº®ç‚¹:**
```vue
<template>
  <NFlex align="center" :wrap="false" :size="12">
    <!-- å…¨å±€å˜é‡ - ä¸¤ç§æ¨¡å¼éƒ½æ˜¾ç¤º -->
    <NButton
      size="small"
      type="default"
      @click="$emit('open-global-variables')"
      :title="$t('contextMode.actions.globalVariables')"
    >
      <template #icon><span>ğŸ“Š</span></template>
      {{ $t('contextMode.actions.globalVariables') }}
    </NButton>

    <!-- ä¼šè¯å˜é‡ - ä¸¤ç§æ¨¡å¼éƒ½æ˜¾ç¤º -->
    <NButton
      size="small"
      @click="$emit('open-context-variables')"
    >
      <template #icon><span>ğŸ“</span></template>
      {{ $t('contextMode.actions.contextVariables') }}
    </NButton>

    <!-- å·¥å…·ç®¡ç† - ä»…ç”¨æˆ·æ¨¡å¼æ˜¾ç¤º -->
    <NButton
      v-if="contextMode === 'user'"
      size="small"
      @click="$emit('open-tool-manager')"
    >
      <template #icon><span>ğŸ”§</span></template>
      {{ $t('contextMode.actions.tools') }}
    </NButton>
  </NFlex>
</template>

<script setup lang="ts">
import type { ContextMode } from '@prompt-optimizer/core'

defineProps<{
  contextMode: ContextMode
}>()

defineEmits<{
  'open-global-variables': []
  'open-context-variables': []
  'open-tool-manager': []
}>()
</script>
```

**ä¼˜ç‚¹:**
- âœ… ç®€æ´çš„æ¡ä»¶æ¸²æŸ“ (`v-if="contextMode === 'user'"`)
- âœ… è¯­ä¹‰åŒ–çš„ emoji å›¾æ ‡
- âœ… å›½é™…åŒ–æ”¯æŒ (`$t()`)
- âœ… ç±»å‹å®‰å…¨çš„ emit å®šä¹‰

**âš ï¸ å½“å‰é—®é¢˜:**

**é—®é¢˜**: è®¾è®¡æ–‡æ¡£ä¸­æåˆ°"å·¥å…·ç®¡ç† - ä¸¤ç§æ¨¡å¼éƒ½æ˜¾ç¤º"ï¼Œä½†å®é™…ä»£ç æ˜¯ `v-if="contextMode === 'user'"`

**å½±å“**: ç³»ç»Ÿæ¨¡å¼æ— æ³•ç®¡ç†å·¥å…·ï¼ˆå¦‚æœéœ€è¦çš„è¯ï¼‰

**å»ºè®®**: 
1. ç»Ÿä¸€è®¾è®¡æ–‡æ¡£å’Œå®ç°ï¼Œæ˜ç¡®ç³»ç»Ÿæ¨¡å¼æ˜¯å¦éœ€è¦å·¥å…·ç®¡ç†
2. å¦‚æœç³»ç»Ÿæ¨¡å¼ä¹Ÿéœ€è¦ï¼Œç§»é™¤ `v-if` æ¡ä»¶
3. å¦‚æœç¡®å®åªæœ‰ç”¨æˆ·æ¨¡å¼éœ€è¦ï¼Œæ›´æ–°è®¾è®¡æ–‡æ¡£

---

### 3.2 `ConversationManager.vue` - ä¼šè¯ç®¡ç†å™¨

**æ–‡ä»¶**: `packages/ui/src/components/context-mode/ConversationManager.vue`

**è®¾è®¡äº®ç‚¹:**

#### 1ï¸âƒ£ **æ€§èƒ½ä¼˜åŒ–**
```typescript
// ä½¿ç”¨é˜²æŠ–å‡å°‘é¢‘ç¹æ›´æ–°
const handleMessageUpdate = debounce(
  (index: number, message: ConversationMessage) => {
    const newMessages = [...props.messages];
    newMessages[index] = message;
    emit('update:messages', newMessages);
    emit('messageChange', index, message, 'update');
    recordUpdate();
  },
  150 // 150ms å¹³è¡¡å“åº”æ€§å’Œæ€§èƒ½
);

// æ‰¹å¤„ç†çŠ¶æ€æ›´æ–°
const batchStateUpdate = batchExecute((updates: Array<() => void>) => {
  updates.forEach((update) => update());
  recordUpdate();
}, 16); // 16ms åŒ¹é… 60fps
```

#### 2ï¸âƒ£ **æ¨¡å¼åŒ–è¡Œä¸º**
```typescript
const canEditMessages = computed(() => {
  // readonly ä¼˜å…ˆçº§æœ€é«˜
  if (props.readonly) return false;
  
  // ç”¨æˆ·æ¨¡å¼ä¸å…è®¸ç¼–è¾‘æ¶ˆæ¯
  if (props.contextMode === 'user') return false;
  
  // ç³»ç»Ÿæ¨¡å¼å…è®¸ç¼–è¾‘
  return true;
});
```

#### 3ï¸âƒ£ **ç´§å‡‘å¸ƒå±€è®¾è®¡**
```vue
<div class="cm-row">
  <!-- è§’è‰²æ ‡ç­¾ (å°å·ï¼Œä¸‹æ‹‰é€‰æ‹©) -->
  <NDropdown :options="roleOptions" @select="handleRoleSelect">
    <NTag :size="tagSize" clickable>
      {{ $t(`conversation.roles.${message.role}`) }}
    </NTag>
  </NDropdown>

  <!-- å†…å®¹è¾“å…¥ï¼Œå•è¡Œè‡ªå¢é«˜ -->
  <div class="content">
    <NInput
      v-model="message.content"
      type="textarea"
      :autosize="{ minRows: 1, maxRows: 1 }"
      :resizable="false"
    />
  </div>

  <!-- æ“ä½œæŒ‰é’® (hover æ˜¾ç¤º) -->
  <NSpace class="actions">
    <NButton @click="moveUp" quaternary circle />
    <NButton @click="moveDown" quaternary circle />
    <NButton @click="delete" quaternary circle type="error" />
  </NSpace>
</div>

<style scoped>
.cm-row {
  display: flex;
  align-items: center;
  gap: 8px;
  flex-wrap: nowrap;
}

.cm-row .actions {
  opacity: 0.6;
  transition: opacity 0.15s ease;
}

.cm-row:hover .actions {
  opacity: 1; /* Hover æ—¶æ˜¾ç¤ºæ“ä½œæŒ‰é’® */
}

.cm-row .content {
  flex: 1 1 auto;
  min-width: 0;
}
</style>
```

**ä¼˜ç‚¹:**
- âœ… å•è¡Œå¸ƒå±€èŠ‚çœç©ºé—´
- âœ… Hover æ˜¾ç¤ºæ“ä½œæŒ‰é’®å‡å°‘è§†è§‰å™ªéŸ³
- âœ… ä¸‹æ‹‰èœå•æ·»åŠ æ¶ˆæ¯æ”¯æŒå¤šç§è§’è‰² (system/user/assistant/tool)
- âœ… æ€§èƒ½ä¼˜åŒ–åˆ°ä½ï¼ˆé˜²æŠ– + æ‰¹å¤„ç†ï¼‰

**âš ï¸ æ½œåœ¨é—®é¢˜:**

**é—®é¢˜**: å•è¡Œè¾“å…¥é™åˆ¶ (`autosize: { minRows: 1, maxRows: 1 }`) å¯èƒ½å¯¼è‡´é•¿æ–‡æœ¬éš¾ä»¥ç¼–è¾‘

**åœºæ™¯ç¤ºä¾‹:**
```
å½“æ¶ˆæ¯å†…å®¹è¾ƒé•¿æ—¶:
system: "ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„æ­Œæ›²åˆ›ä½œåŠ©æ‰‹ï¼Œæ“…é•¿åˆ›ä½œå„ç§é£æ ¼çš„æ­Œæ›²ï¼ŒåŒ…æ‹¬æµè¡Œã€æ‘‡æ»šã€æ°‘è°£ã€è¯´å”±ç­‰..."
```

å•è¡Œæ˜¾ç¤ºä¼šå¯¼è‡´:
- âŒ å†…å®¹è¢«æˆªæ–­ï¼Œéœ€è¦æ¨ªå‘æ»šåŠ¨
- âŒ éš¾ä»¥çœ‹åˆ°å®Œæ•´ä¸Šä¸‹æ–‡
- âŒ ç¼–è¾‘ä½“éªŒå·®

**æ”¹è¿›å»ºè®®:**

#### æ–¹æ¡ˆ 1: å±•å¼€/æŠ˜å åŠŸèƒ½
```vue
<script setup lang="ts">
const expandedRows = ref(new Set<number>());

const toggleExpand = (index: number) => {
  if (expandedRows.value.has(index)) {
    expandedRows.value.delete(index);
  } else {
    expandedRows.value.add(index);
  }
};
</script>

<template>
  <div class="cm-row" :class="{ 'expanded': expandedRows.has(index) }">
    <!-- å•è¡Œæ¨¡å¼ -->
    <NInput
      v-if="!expandedRows.has(index)"
      :autosize="{ minRows: 1, maxRows: 1 }"
      @dblclick="toggleExpand(index)"
      placeholder="åŒå‡»å±•å¼€ç¼–è¾‘"
    />
    
    <!-- å±•å¼€æ¨¡å¼ -->
    <NInput
      v-else
      :autosize="{ minRows: 3, maxRows: 20 }"
      @blur="toggleExpand(index)"
    />
    
    <!-- å±•å¼€/æŠ˜å æŒ‰é’® -->
    <NButton @click="toggleExpand(index)" quaternary circle>
      <template #icon>
        <svg v-if="!expandedRows.has(index)"><!-- å±•å¼€å›¾æ ‡ --></svg>
        <svg v-else><!-- æŠ˜å å›¾æ ‡ --></svg>
      </template>
    </NButton>
  </div>
</template>
```

#### æ–¹æ¡ˆ 2: ç›´æ¥è·³è½¬åˆ°å®Œæ•´ç¼–è¾‘å™¨
```vue
<NButton
  @click="emit('open-context-editor')"
  type="primary"
  :loading="loading"
>
  <template #icon>
    <svg><!-- ç¼–è¾‘å›¾æ ‡ --></svg>
  </template>
  {{ $t('conversation.management.openEditor') }}
</NButton>
```

---

### 3.3 `PromptPreviewPanel.vue` - å®æ—¶é¢„è§ˆé¢æ¿

**æ–‡ä»¶**: `packages/ui/src/components/PromptPreviewPanel.vue`

**è®¾è®¡äº®ç‚¹:**

#### 1ï¸âƒ£ **å˜é‡ç»Ÿè®¡å¯è§†åŒ–**
```vue
<NCard size="small" :title="$t('contextMode.preview.stats')">
  <NFlex :size="12" :wrap="true">
    <NTag :bordered="false" type="info">
      {{ $t('contextMode.preview.totalVars') }}: {{ variableStats.total }}
    </NTag>
    <NTag :bordered="false" type="success">
      {{ $t('contextMode.preview.providedVars') }}: {{ variableStats.provided }}
    </NTag>
    <NTag v-if="variableStats.missing > 0" :bordered="false" type="warning">
      {{ $t('contextMode.preview.missingVars') }}: {{ variableStats.missing }}
    </NTag>
  </NFlex>
</NCard>
```

#### 2ï¸âƒ£ **ç¼ºå¤±å˜é‡é«˜äº®**
```vue
<NCard
  v-if="hasMissingVariables"
  size="small"
  :title="$t('contextMode.preview.missingVarsWarning')"
>
  <NFlex :size="8" :wrap="true">
    <NTag
      v-for="varName in missingVariables"
      :key="varName"
      type="warning"
      :bordered="false"
    >
      <span v-text="`{{${varName}}}`"></span>
    </NTag>
  </NFlex>
  <template #footer>
    <NText depth="3">
      {{ $t('contextMode.preview.missingVarsHint') }}
    </NText>
  </template>
</NCard>
```

#### 3ï¸âƒ£ **æ¨¡å¼è¯´æ˜åŠ¨æ€æç¤º**
```vue
<NCard size="small" :title="$t('contextMode.preview.modeExplanation')">
  <NText depth="2">
    <template v-if="contextMode === 'user' && renderPhase === 'optimize'">
      {{ $t('contextMode.preview.userOptimizeHint') }}
      <!-- "ç”¨æˆ·ä¼˜åŒ–æ¨¡å¼ï¼šå˜é‡å°†åœ¨ä¼˜åŒ–æ—¶ä¿ç•™ï¼Œæµ‹è¯•æ—¶æ›¿æ¢ä¸ºå®é™…å€¼" -->
    </template>
    <template v-else-if="contextMode === 'system' && renderPhase === 'optimize'">
      {{ $t('contextMode.preview.systemOptimizeHint') }}
      <!-- "ç³»ç»Ÿä¼˜åŒ–æ¨¡å¼ï¼šå†…ç½®å˜é‡æ›¿æ¢ï¼Œè‡ªå®šä¹‰å˜é‡ä¿ç•™" -->
    </template>
    <template v-else>
      {{ $t('contextMode.preview.testPhaseHint') }}
      <!-- "æµ‹è¯•é˜¶æ®µï¼šæ‰€æœ‰å˜é‡æ›¿æ¢ä¸ºå®é™…å€¼" -->
    </template>
  </NText>
</NCard>
```

**ä¼˜ç‚¹:**
- âœ… ä¿¡æ¯å±‚æ¬¡æ¸…æ™°ï¼ˆç»Ÿè®¡ â†’ è­¦å‘Š â†’ å†…å®¹ â†’ è¯´æ˜ï¼‰
- âœ… é¢œè‰²è¯­ä¹‰åŒ–ï¼ˆinfo/success/warningï¼‰
- âœ… æ•™è‚²ç”¨æˆ·ç†è§£ä¸¤é˜¶æ®µå¤„ç†
- âœ… å“åº”å¼å¸ƒå±€ (`:wrap="true"`)

**ğŸ’¡ æ”¹è¿›å»ºè®®: ç¼ºå¤±å˜é‡å¿«é€Ÿæ“ä½œ**

**å½“å‰è¡Œä¸º:**
```vue
<!-- ç¼ºå¤±å˜é‡ä»…æ˜¾ç¤ºï¼Œæ— æ³•å¿«é€Ÿæ“ä½œ -->
<NTag v-for="varName in missingVariables" :key="varName" type="warning">
  {{{{ varName }}}}
</NTag>
```

**æ”¹è¿›å:**
```vue
<!-- ç‚¹å‡»ç¼ºå¤±å˜é‡å¿«é€Ÿåˆ›å»º/ç¼–è¾‘ -->
<NTag
  v-for="varName in missingVariables"
  :key="varName"
  type="warning"
  clickable
  @click="handleQuickCreateVariable(varName)"
  :title="$t('contextMode.preview.clickToCreateVariable')"
>
  <span v-text="`{{${varName}}}`"></span>
</NTag>

<script setup lang="ts">
const emit = defineEmits<{
  'create-variable': [varName: string]
  'update:show': [value: boolean]
}>()

const handleQuickCreateVariable = (varName: string) => {
  // æ–¹æ¡ˆ1: è§¦å‘äº‹ä»¶è®©çˆ¶ç»„ä»¶å¤„ç†
  emit('create-variable', varName);
  
  // æ–¹æ¡ˆ2: ç›´æ¥æ‰“å¼€å˜é‡ç®¡ç†å™¨å¹¶èšç„¦è¯¥å˜é‡
  // router.push({ name: 'variable-manager', query: { focus: varName } });
};
</script>
```

**ç”¨æˆ·ä½“éªŒæå‡:**
```
ä¹‹å‰: çœ‹åˆ°ç¼ºå¤±å˜é‡ â†’ å…³é—­é¢„è§ˆ â†’ æ‰‹åŠ¨æ‰“å¼€å˜é‡ç®¡ç†å™¨ â†’ æ‰¾åˆ°å˜é‡ â†’ ç¼–è¾‘
ç°åœ¨: çœ‹åˆ°ç¼ºå¤±å˜é‡ â†’ ç‚¹å‡» â†’ ç›´æ¥åˆ›å»º/ç¼–è¾‘ âœ…
```

---

### 3.4 `usePromptPreview.ts` - é¢„è§ˆé€»è¾‘

**æ–‡ä»¶**: `packages/ui/src/composables/usePromptPreview.ts`

**è®¾è®¡äº®ç‚¹:**

#### 1ï¸âƒ£ **ç®€åŒ–çš„å˜é‡æ›¿æ¢**
```typescript
/**
 * æ¸²æŸ“åçš„é¢„è§ˆå†…å®¹
 *
 * ç®€åŒ–ç‰ˆæœ¬ï¼šç»Ÿä¸€ä½¿ç”¨ç®€å•æ›¿æ¢é€»è¾‘
 * æ³¨æ„ï¼šè¿™é‡Œä½¿ç”¨ç®€å•çš„æ­£åˆ™æ›¿æ¢è€Œä¸æ˜¯ Mustacheï¼Œå› ä¸ºï¼š
 * 1. UI é¢„è§ˆä¸éœ€è¦ Mustache çš„æ¡ä»¶æ¸²æŸ“ç­‰é«˜çº§ç‰¹æ€§
 * 2. ç®€å•æ›¿æ¢æ€§èƒ½æ›´å¥½ï¼Œé€‚åˆå®æ—¶é¢„è§ˆ
 * 3. ä¸åç«¯ Mustache è¡Œä¸ºä¸€è‡´ï¼ˆéƒ½ä¼šä¿ç•™å€¼ä¸­çš„å ä½ç¬¦ï¼‰
 */
const previewContent = computed(() => {
  if (!content.value) return "";

  try {
    const vars = variables.value || {};

    // ç»Ÿä¸€çš„å˜é‡æ›¿æ¢é€»è¾‘
    const result = content.value.replace(
      /\{\{([^{}]+)\}\}/g,
      (match, varName) => {
        const trimmedName = varName.trim();

        // è·³è¿‡ Mustache ç‰¹æ®Šæ ‡ç­¾ (#, /, ^, !, >, &)
        if (
          trimmedName.startsWith("#") ||
          trimmedName.startsWith("/") ||
          trimmedName.startsWith("^") ||
          trimmedName.startsWith("!") ||
          trimmedName.startsWith(">") ||
          trimmedName.startsWith("&")
        ) {
          return match;
        }

        // å¦‚æœå˜é‡å­˜åœ¨ä¸”éç©ºï¼Œæ›¿æ¢ï¼›å¦åˆ™ä¿ç•™å ä½ç¬¦
        if (vars[trimmedName] !== undefined && vars[trimmedName] !== "") {
          return vars[trimmedName];
        }
        return match;
      }
    );

    return result;
  } catch (error) {
    console.error("[usePromptPreview] Preview rendering failed:", error);
    return content.value;
  }
});
```

#### 2ï¸âƒ£ **å˜é‡ç»Ÿè®¡**
```typescript
const variableStats = computed(() => ({
  total: parsedVariables.value.allVars.size,
  builtin: parsedVariables.value.builtinVars.size,
  custom: parsedVariables.value.customVars.size,
  missing: missingVariables.value.length,
  provided: parsedVariables.value.allVars.size - missingVariables.value.length,
}));
```

**ä¼˜ç‚¹:**
- âœ… æ€§èƒ½ä¼˜äº Mustacheï¼ˆé¢„è§ˆåœºæ™¯è¶³å¤Ÿï¼‰
- âœ… ä¸åç«¯è¡Œä¸ºä¸€è‡´ï¼ˆéƒ½ä¿ç•™å€¼ä¸­çš„å ä½ç¬¦ï¼‰
- âœ… è·³è¿‡ Mustache ç‰¹æ®Šæ ‡ç­¾
- âœ… é”™è¯¯å¤„ç†å®Œå–„

**âš ï¸ æ½œåœ¨é—®é¢˜:**

**é—®é¢˜**: ä¸åç«¯ Mustache å¯èƒ½å­˜åœ¨ä¸ä¸€è‡´çš„é£é™©

**åœºæ™¯**: å¦‚æœæ¨¡æ¿ä½¿ç”¨äº† Mustache çš„é«˜çº§ç‰¹æ€§ï¼Œé¢„è§ˆå¯èƒ½ä¸å‡†ç¡®

```mustache
{{! æ³¨é‡Š }}
{{#if showTitle}}
  æ ‡é¢˜ï¼š{{title}}
{{/if}}

{{#each items}}
  - {{name}}: {{value}}
{{/each}}
```

å½“å‰ç®€å•æ­£åˆ™æ›¿æ¢æ— æ³•å¤„ç†:
- âŒ æ¡ä»¶æ¸²æŸ“ (`{{#if}}...{{/if}}`)
- âŒ å¾ªç¯æ¸²æŸ“ (`{{#each}}...{{/each}}`)
- âŒ éƒ¨åˆ†æ¸²æŸ“ (`{{>partial}}`)

**æ”¹è¿›å»ºè®®:**

#### æ–¹æ¡ˆ 1: æ–‡æ¡£è¯´æ˜é™åˆ¶
```typescript
/**
 * æç¤ºè¯é¢„è§ˆ Composable
 *
 * ç”¨äºå®æ—¶è®¡ç®—æç¤ºè¯æ¸²æŸ“ç»“æœå¹¶æ£€æµ‹ç¼ºå¤±å˜é‡
 *
 * âš ï¸ é™åˆ¶è¯´æ˜:
 * - ä½¿ç”¨ç®€å•æ­£åˆ™æ›¿æ¢ï¼Œä¸æ”¯æŒ Mustache é«˜çº§ç‰¹æ€§
 * - ä¸æ”¯æŒæ¡ä»¶æ¸²æŸ“ ({{#if}})ã€å¾ªç¯ ({{#each}})ã€éƒ¨åˆ†æ¨¡æ¿ ({{>}})
 * - ä»…ç”¨äºåŸºæœ¬å˜é‡é¢„è§ˆï¼Œæœ€ç»ˆæ¸²æŸ“ä»¥åç«¯ä¸ºå‡†
 * - å¦‚éœ€å®Œæ•´ Mustache æ¸²æŸ“ï¼Œè¯·ä½¿ç”¨åç«¯ API
 */
```

#### æ–¹æ¡ˆ 2: é›†æˆ Mustache.js
```typescript
import Mustache from 'mustache';

const previewContent = computed(() => {
  try {
    // ä½¿ç”¨ Mustache å®Œæ•´æ¸²æŸ“
    return Mustache.render(content.value, variables.value);
  } catch (error) {
    // é™çº§åˆ°ç®€å•æ›¿æ¢
    return content.value.replace(/\{\{([^{}]+)\}\}/g, ...);
  }
});
```

**æƒè¡¡:**
- **æ–¹æ¡ˆ 1**: ç®€å•ï¼Œä½†åŠŸèƒ½æœ‰é™ï¼Œéœ€è¦ç”¨æˆ·ç†è§£é™åˆ¶
- **æ–¹æ¡ˆ 2**: åŠŸèƒ½å®Œæ•´ï¼Œä½†å¢åŠ ä¾èµ–å’Œå¤æ‚åº¦

**å»ºè®®**: å½“å‰æ–¹æ¡ˆ 1 è¶³å¤Ÿï¼Œåœ¨æ–‡æ¡£ä¸­æ˜ç¡®è¯´æ˜å³å¯

---

## å››ã€UI äº¤äº’æµç¨‹åˆ†æ

### 4.1 ç”¨æˆ·æ¨¡å¼å®Œæ•´æµç¨‹

```mermaid
graph TD
    A[ç”¨æˆ·è¾“å…¥æç¤ºè¯<br/>'å†™ä¸€é¦–{{style}}çš„æ­Œ'] --> B{ç‚¹å‡»ä¼˜åŒ–}
    B --> C[AI ä¼˜åŒ–<br/>ä¿ç•™ {{style}} å ä½ç¬¦]
    C --> D[ä¼˜åŒ–ç»“æœæ˜¾ç¤º<br/>'è¯·åˆ›ä½œä¸€é¦–é£æ ¼ä¸º{{style}}çš„æ­Œ...']
    D --> E[ç”¨æˆ·è®¾ç½®å˜é‡<br/>style = 'æ¬¢å¿«']
    E --> F[å®æ—¶é¢„è§ˆæ›´æ–°<br/>'è¯·åˆ›ä½œä¸€é¦–é£æ ¼ä¸ºæ¬¢å¿«çš„æ­Œ...']
    F --> G{ç‚¹å‡»æµ‹è¯•}
    G --> H[æ›¿æ¢æ‰€æœ‰å˜é‡]
    H --> I[å‘é€ç»™ LLM]
    I --> J[æ˜¾ç¤ºæµ‹è¯•ç»“æœ]
    
    style C fill:#e1f5e1
    style F fill:#fff3cd
    style H fill:#f8d7da
```

**å…³é”®æ­¥éª¤è¯´æ˜:**

1. **ä¼˜åŒ–é˜¶æ®µ** (ç»¿è‰²) - å ä½ç¬¦ä¿ç•™
   - ç”¨æˆ·è¾“å…¥: `"å†™ä¸€é¦–{{style}}çš„æ­Œ"`
   - å‘é€ç»™ AI: åŒ…å« `{{style}}` å­—é¢æ–‡æœ¬
   - AI ä¼˜åŒ–: ä¿ç•™æ‰€æœ‰å ä½ç¬¦
   - ä¼˜åŒ–ç»“æœ: `"è¯·åˆ›ä½œä¸€é¦–é£æ ¼ä¸º{{style}}çš„æ­Œ..."`

2. **é¢„è§ˆé˜¶æ®µ** (é»„è‰²) - å®æ—¶æ¸²æŸ“
   - ç”¨æˆ·è®¾ç½®: `style = "æ¬¢å¿«"`
   - é¢„è§ˆæ˜¾ç¤º: `"è¯·åˆ›ä½œä¸€é¦–é£æ ¼ä¸ºæ¬¢å¿«çš„æ­Œ..."`
   - å˜é‡ç»Ÿè®¡: æ€»æ•° 1, å·²æä¾› 1, ç¼ºå¤± 0

3. **æµ‹è¯•é˜¶æ®µ** (çº¢è‰²) - å®Œå…¨æ›¿æ¢
   - åˆå¹¶ä¸‰å±‚å˜é‡ (å…¨å±€ â† ä¼šè¯ â† å†…ç½®)
   - æ›¿æ¢æ‰€æœ‰å ä½ç¬¦
   - å‘é€ç»™ LLM: ä¸åŒ…å«ä»»ä½• `{{}}`

### 4.2 ç³»ç»Ÿæ¨¡å¼å®Œæ•´æµç¨‹

```mermaid
graph TD
    A[ç¼–è¾‘å¤šæ¡æ¶ˆæ¯<br/>system/user/assistant] --> B[è®¾ç½®ä¼šè¯å˜é‡<br/>style = 'æ¬¢å¿«']
    B --> C{ç‚¹å‡»ä¼˜åŒ–}
    C --> D[æ›¿æ¢å†…ç½®å˜é‡<br/>ä¿ç•™è‡ªå®šä¹‰å˜é‡]
    D --> E[ä¼˜åŒ–ç»“æœæ˜¾ç¤º]
    E --> F[è¾“å…¥æµ‹è¯•é—®é¢˜<br/>'è¯·ç”Ÿæˆä¸€é¦–æ­Œ']
    F --> G[å®æ—¶é¢„è§ˆæ›´æ–°<br/>æ‰€æœ‰å˜é‡å·²æ›¿æ¢]
    G --> H{ç‚¹å‡»æµ‹è¯•}
    H --> I[æ›¿æ¢æ‰€æœ‰å˜é‡<br/>åŒ…æ‹¬æµ‹è¯•é—®é¢˜]
    I --> J[å‘é€ç»™ LLM]
    J --> K[æ˜¾ç¤ºæµ‹è¯•ç»“æœ]
    
    style D fill:#e1f5e1
    style G fill:#fff3cd
    style I fill:#f8d7da
```

**å…³é”®æ­¥éª¤è¯´æ˜:**

1. **ä¼šè¯ç¼–è¾‘** - å¤šæ¶ˆæ¯ç®¡ç†
   - system: `"ä½ æ˜¯æ­Œæ›²åˆ›ä½œåŠ©æ‰‹"`
   - user: `"åˆ›ä½œ{{style}}çš„æ­Œ"`
   - assistant: `"å¥½çš„ï¼Œæˆ‘ä¼šåˆ›ä½œ..."`

2. **ä¼˜åŒ–é˜¶æ®µ** (ç»¿è‰²) - åˆ†å±‚æ›¿æ¢
   - æ›¿æ¢å†…ç½®å˜é‡: `{{originalPrompt}}`, `{{conversationContext}}`
   - ä¿ç•™è‡ªå®šä¹‰å˜é‡: `{{style}}`

3. **æµ‹è¯•é˜¶æ®µ** (é»„è‰² â†’ çº¢è‰²) - å®Œå…¨æ¸²æŸ“
   - éœ€è¦é¢å¤–è¾“å…¥ç”¨æˆ·é—®é¢˜
   - é¢„è§ˆæ˜¾ç¤ºæ‰€æœ‰å˜é‡æ›¿æ¢åçš„æ•ˆæœ
   - æœ€ç»ˆå‘é€å®Œå…¨æ¸²æŸ“çš„æ¶ˆæ¯æ•°ç»„

---

## äº”ã€UI è®¾è®¡ä¼˜åŠ¿

### âœ… åšå¾—å¥½çš„åœ°æ–¹

#### 1. **æ¨¡å¼åŒ–ç»„ä»¶è®¾è®¡**
- æ¸…æ™°çš„ User/System Workspace åˆ†ç¦»
- ç»„ä»¶æ ¹æ® `contextMode` æ™ºèƒ½è°ƒæ•´è¡Œä¸º
- é¿å…äº†å¤æ‚çš„ if-else åˆ¤æ–­

**ä»£ç ç¤ºä¾‹:**
```typescript
// ConversationManager.vue
const canEditMessages = computed(() => {
  if (props.contextMode === 'user') return false; // ç”¨æˆ·æ¨¡å¼ç¦æ­¢ç¼–è¾‘
  return true; // ç³»ç»Ÿæ¨¡å¼å…è®¸
});
```

#### 2. **Naive UI ä¸€è‡´æ€§**
- å…¨é¢ä½¿ç”¨ Naive UI ç»„ä»¶ (NCard, NButton, NTag, NInput...)
- ç»Ÿä¸€çš„ size/type/bordered é…ç½®
- ä¸»é¢˜è‡ªé€‚åº” (dark/light mode)

**ç»„ä»¶ä½¿ç”¨ç»Ÿè®¡:**
```
NCard: ä¸»å®¹å™¨
NButton: æ‰€æœ‰æŒ‰é’®
NTag: æ ‡ç­¾ã€ç»Ÿè®¡ã€è§’è‰²æ ‡è¯†
NInput: æ–‡æœ¬è¾“å…¥
NDropdown: è§’è‰²é€‰æ‹©ã€æ¶ˆæ¯æ·»åŠ 
NScrollbar: æ»šåŠ¨åŒºåŸŸ
NEmpty: ç©ºçŠ¶æ€æç¤º
```

#### 3. **å“åº”å¼é€‚é…**
```typescript
// å“åº”å¼é…ç½®
const buttonSize = computed(() => {
  const sizeMap = { small: 'tiny', medium: 'small', large: 'medium' };
  return sizeMap[props.size] || 'small';
});

// ç§»åŠ¨ç«¯é€‚é…
<NGrid :cols="isMobile ? 1 : 2" :x-gap="12" :y-gap="12">
```

#### 4. **æ€§èƒ½ä¼˜åŒ–**
- é˜²æŠ–å¤„ç†é«˜é¢‘æ›´æ–° (150ms)
- æ‰¹å¤„ç†çŠ¶æ€æ›´æ–° (16ms)
- `shallowRef` ä¼˜åŒ–å¤§æ•°æ®
- æ€§èƒ½ç›‘æ§ (`usePerformanceMonitor`)

**æ€§èƒ½ä¼˜åŒ–ä»£ç :**
```typescript
// é˜²æŠ–
const handleMessageUpdate = debounce((index, message) => {
  emit('update:messages', newMessages);
}, 150);

// æ‰¹å¤„ç†
const batchStateUpdate = batchExecute((updates) => {
  updates.forEach(update => update());
}, 16);
```

#### 5. **å¯è®¿é—®æ€§ (a11y)**
- å®Œæ•´çš„ `role` å±æ€§ (dialog, button, list...)
- `aria-label`, `aria-describedby` æ ‡æ³¨
- é”®ç›˜å¯¼èˆªæ”¯æŒ (`@keydown.enter`, `@keydown.space`)
- `tabindex` ç„¦ç‚¹ç®¡ç†

**å¯è®¿é—®æ€§ä»£ç :**
```vue
<NModal
  role="dialog"
  :aria-label="aria.getLabel('contextEditor')"
  :aria-describedby="aria.getDescription('contextEditor')"
  aria-modal="true"
>
  <NButton
    @click="addMessage"
    @keydown.enter="addMessage"
    @keydown.space.prevent="addMessage"
    :aria-label="aria.getLabel('addMessage')"
  />
</NModal>
```

#### 6. **å›½é™…åŒ–å®Œå¤‡**
- æ‰€æœ‰æ–‡æ¡ˆä½¿ç”¨ `$t()` / `t()`
- æ”¯æŒä¸­è‹±æ–‡åˆ‡æ¢
- åŠ¨æ€æ’å€¼ (`$t('key', { count: 5 })`)

**å›½é™…åŒ–ç¤ºä¾‹:**
```typescript
// zh-CN.ts
export default {
  contextMode: {
    user: { label: 'ç”¨æˆ·æ¨¡å¼' },
    system: { label: 'ç³»ç»Ÿæ¨¡å¼' },
    actions: {
      globalVariables: 'å…¨å±€å˜é‡',
      contextVariables: 'ä¼šè¯å˜é‡',
      tools: 'å·¥å…·ç®¡ç†'
    }
  }
}

// ä½¿ç”¨
<NTag>{{ $t('contextMode.user.label') }}</NTag>
```

---

## å…­ã€UI è®¾è®¡é—®é¢˜ä¸æ”¹è¿›å»ºè®®

### âš ï¸ å½“å‰é—®é¢˜æ±‡æ€»

| é—®é¢˜ | ä½ç½® | å½±å“ | ä¼˜å…ˆçº§ | æ”¹é€ çŠ¶æ€ |
|------|------|------|--------|---------|
| **å­æ¨¡å¼é€‰æ‹©å™¨ä½ç½®ä¸å½“** | `InputPanel.vue` + `ContextUserWorkspace.vue` | å±‚çº§æ··ä¹±ï¼Œä½œç”¨åŸŸä¸æ˜ç¡® | P0 ğŸ”´ | âœ… å·²è§„åˆ’ |
| **å¿«æ·æ“ä½œæ ä½ç½®ä¸å½“** | `ContextUserWorkspace.vue:11` | ä½œç”¨åŸŸä¸æ˜ç¡®ï¼Œæ“ä½œè·¯å¾„è¿œ | P0 ğŸ”´ | âœ… å·²è§„åˆ’ |
| **å·¥å…·ç®¡ç†æŒ‰é’®æ˜¾ç¤ºé€»è¾‘ä¸ä¸€è‡´** | `ContextModeActions.vue:18` | æ–‡æ¡£è¯´"ä¸¤ç§æ¨¡å¼éƒ½æ˜¾ç¤º"ï¼Œä»£ç æ˜¯ `v-if="user"` | P1 ğŸ”´ | ğŸ“‹ å¾…ç¡®è®¤ |
| **ä¼šè¯ç®¡ç†å™¨å•è¡Œè¾“å…¥é™åˆ¶** | `ConversationManager.vue:215` | é•¿æ¶ˆæ¯éš¾ä»¥ç¼–è¾‘ | P2 ğŸŸ¡ | ğŸ“‹ å¾…è§„åˆ’ |
| **ç¼ºå¤±å˜é‡æ— å¿«é€Ÿæ“ä½œ** | `PromptPreviewPanel.vue:32` | éœ€è¦æ‰‹åŠ¨æ‰“å¼€å˜é‡ç®¡ç†å™¨ï¼Œæµç¨‹ç¹ç | P2 ğŸŸ¡ | ğŸ“‹ å¾…è§„åˆ’ |
| **é¢„è§ˆä¸åç«¯å¯èƒ½ä¸ä¸€è‡´** | `usePromptPreview.ts:85` | ä¸æ”¯æŒ Mustache é«˜çº§ç‰¹æ€§ | P3 ğŸŸ¢ | ğŸ“‹ å¾…è§„åˆ’ |
| **å˜é‡æ¥æºæœªå¯è§†åŒ–** | `TestAreaPanel.vue` | æ— æ³•åŒºåˆ†å…¨å±€/ä¼šè¯/å†…ç½®å˜é‡ | P2 ğŸŸ¡ | ğŸ“‹ å¾…è§„åˆ’ |

**å›¾ä¾‹:**
- âœ… å·²è§„åˆ’ï¼šå·²ç¼–å†™è¯¦ç»†æ”¹é€ æ–¹æ¡ˆï¼Œç­‰å¾…å®æ–½
- ğŸ“‹ å¾…è§„åˆ’ï¼šé—®é¢˜å·²è¯†åˆ«ï¼Œå¾…åˆ¶å®šè¯¦ç»†æ–¹æ¡ˆ
- ğŸ”´ P0/P1ï¼šé«˜ä¼˜å…ˆçº§ï¼Œéœ€è¦ç«‹å³å¤„ç†
- ğŸŸ¡ P2ï¼šä¸­ä¼˜å…ˆçº§ï¼Œè¿‘æœŸå¤„ç†
- ğŸŸ¢ P3ï¼šä½ä¼˜å…ˆçº§ï¼Œé•¿æœŸä¼˜åŒ–

### ğŸ’¡ æ”¹è¿›å»ºè®®è¯¦è§£

#### æ”¹è¿› 1: ç»Ÿä¸€å·¥å…·ç®¡ç†æŒ‰é’®é€»è¾‘

**å½“å‰çŠ¶æ€:**
```vue
<!-- ContextModeActions.vue -->
<NButton v-if="contextMode === 'user'" @click="emit('open-tool-manager')">
  ğŸ”§ å·¥å…·ç®¡ç†
</NButton>
```

**é—®é¢˜åˆ†æ:**
- è®¾è®¡æ–‡æ¡£: "å·¥å…·ç®¡ç† - ä¸¤ç§æ¨¡å¼éƒ½æ˜¾ç¤º"
- å®é™…ä»£ç : ä»…ç”¨æˆ·æ¨¡å¼æ˜¾ç¤º
- ä¸ä¸€è‡´æ¥æº: è®¾è®¡å˜æ›´æœªåŒæ­¥åˆ°æ–‡æ¡£

**è§£å†³æ–¹æ¡ˆ:**

**æ–¹æ¡ˆ A**: ç§»é™¤æ¡ä»¶ï¼Œä¸¤ç§æ¨¡å¼éƒ½æ˜¾ç¤º
```vue
<NButton @click="emit('open-tool-manager')">
  ğŸ”§ å·¥å…·ç®¡ç†
</NButton>
```

**æ–¹æ¡ˆ B**: ä¿æŒå½“å‰å®ç°ï¼Œæ›´æ–°è®¾è®¡æ–‡æ¡£
```markdown
- å·¥å…·ç®¡ç† - ä»…ç”¨æˆ·æ¨¡å¼æ˜¾ç¤º (ç³»ç»Ÿæ¨¡å¼é€šè¿‡ä¸Šä¸‹æ–‡ç¼–è¾‘å™¨ç®¡ç†)
```

**å»ºè®®**: é‡‡ç”¨æ–¹æ¡ˆ Bï¼Œå› ä¸ºç³»ç»Ÿæ¨¡å¼å·¥å…·ç®¡ç†åº”è¯¥åœ¨ ContextEditor çš„ "å·¥å…·è°ƒç”¨" æ ‡ç­¾é¡µå¤„ç†

---

#### æ”¹è¿› 2: å¢å¼ºä¼šè¯ç®¡ç†å™¨ç¼–è¾‘ä½“éªŒ

**å½“å‰é™åˆ¶:**
```vue
<NInput
  type="textarea"
  :autosize="{ minRows: 1, maxRows: 1 }"
  :resizable="false"
/>
```

**æ”¹è¿›æ–¹æ¡ˆ: å±•å¼€/æŠ˜å ç¼–è¾‘æ¨¡å¼**

**å®ç°ä»£ç :**
```vue
<script setup lang="ts">
const expandedRows = ref(new Set<number>());

const toggleExpand = (index: number) => {
  if (expandedRows.value.has(index)) {
    expandedRows.value.delete(index);
  } else {
    expandedRows.value.add(index);
  }
};

// è‡ªåŠ¨ä¿å­˜å¹¶æŠ˜å 
const handleBlur = (index: number) => {
  setTimeout(() => {
    expandedRows.value.delete(index);
  }, 200); // å»¶è¿Ÿé¿å…ç‚¹å‡»æŒ‰é’®æ—¶ç«‹å³æŠ˜å 
};
</script>

<template>
  <div class="cm-row" :class="{ 'expanded': expandedRows.has(index) }">
    <!-- å•è¡Œæ¨¡å¼ (é»˜è®¤) -->
    <NInput
      v-if="!expandedRows.has(index)"
      :value="message.content"
      type="textarea"
      :autosize="{ minRows: 1, maxRows: 1 }"
      :resizable="false"
      @dblclick="toggleExpand(index)"
      :placeholder="$t('conversation.doubleClickToExpand')"
    />
    
    <!-- å±•å¼€æ¨¡å¼ (ç¼–è¾‘) -->
    <NInput
      v-else
      v-model="message.content"
      type="textarea"
      :autosize="{ minRows: 3, maxRows: 20 }"
      autofocus
      @blur="handleBlur(index)"
    />
    
    <!-- å±•å¼€/æŠ˜å æŒ‰é’® -->
    <NButton
      @click="toggleExpand(index)"
      quaternary
      circle
      :title="expandedRows.has(index) ? $t('common.collapse') : $t('common.expand')"
    >
      <template #icon>
        <!-- å±•å¼€å›¾æ ‡ â†“ -->
        <svg v-if="!expandedRows.has(index)" width="14" height="14">
          <path d="M7 10l5-5H2z" fill="currentColor"/>
        </svg>
        <!-- æŠ˜å å›¾æ ‡ â†‘ -->
        <svg v-else width="14" height="14">
          <path d="M7 4l5 5H2z" fill="currentColor"/>
        </svg>
      </template>
    </NButton>
  </div>
</template>

<style scoped>
.cm-row {
  transition: all 0.2s ease;
}

.cm-row.expanded {
  background-color: var(--n-color-embedded);
  padding: 8px;
  border-radius: 4px;
}
</style>
```

**ç”¨æˆ·ä½“éªŒ:**
```
å½“å‰: å•è¡Œæ˜¾ç¤ºï¼Œé•¿æ–‡æœ¬è¢«æˆªæ–­ âŒ
      "ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„æ­Œæ›²åˆ›ä½œåŠ©æ‰‹ï¼Œæ“…é•¿åˆ›ä½œ..." [æ¨ªå‘æ»šåŠ¨]

æ”¹è¿›: åŒå‡»å±•å¼€ï¼Œ3-20è¡Œè‡ªé€‚åº” âœ…
      "ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„æ­Œæ›²åˆ›ä½œåŠ©æ‰‹ï¼Œæ“…é•¿åˆ›ä½œå„ç§é£æ ¼çš„æ­Œæ›²ï¼Œ
       åŒ…æ‹¬æµè¡Œã€æ‘‡æ»šã€æ°‘è°£ã€è¯´å”±ç­‰ã€‚ä½ èƒ½å¤Ÿæ ¹æ®ç”¨æˆ·çš„éœ€æ±‚ï¼Œ
       åˆ›ä½œå‡ºä¼˜ç§€çš„æ­Œè¯å’Œæ—‹å¾‹å»ºè®®ã€‚"
       [å¤±ç„¦è‡ªåŠ¨æŠ˜å ]
```

---

#### æ”¹è¿› 3: é¢„è§ˆé¢æ¿æ·»åŠ å¿«é€Ÿå˜é‡åˆ›å»º

**å½“å‰ä½“éªŒ:**
```
ç”¨æˆ·çœ‹åˆ°ç¼ºå¤±å˜é‡ â†’ å…³é—­é¢„è§ˆ â†’ æ‰‹åŠ¨æ‰“å¼€å˜é‡ç®¡ç†å™¨ â†’ æ‰¾åˆ°å˜é‡ â†’ ç¼–è¾‘
```

**æ”¹è¿›åä½“éªŒ:**
```
ç”¨æˆ·çœ‹åˆ°ç¼ºå¤±å˜é‡ â†’ ç‚¹å‡»æ ‡ç­¾ â†’ ç›´æ¥åˆ›å»º/ç¼–è¾‘ âœ…
```

**å®ç°ä»£ç :**
```vue
<!-- PromptPreviewPanel.vue -->
<template>
  <NCard v-if="hasMissingVariables">
    <NFlex :size="8" :wrap="true">
      <NTag
        v-for="varName in missingVariables"
        :key="varName"
        type="warning"
        clickable
        @click="handleQuickCreateVariable(varName)"
        class="cursor-pointer hover:scale-105 transition-transform"
      >
        <template #icon>
          <svg width="12" height="12" viewBox="0 0 24 24">
            <path d="M12 6v12m6-6H6" stroke="currentColor" stroke-width="2"/>
          </svg>
        </template>
        <span v-text="`{{${varName}}}`"></span>
      </NTag>
    </NFlex>
    
    <template #footer>
      <NText depth="3" :style="{ fontSize: '13px' }">
        ğŸ’¡ {{ $t('contextMode.preview.clickToCreateVariableHint') }}
      </NText>
    </template>
  </NCard>
</template>

<script setup lang="ts">
const emit = defineEmits<{
  'create-variable': [varName: string]
  'update:show': [value: boolean]
}>()

const handleQuickCreateVariable = async (varName: string) => {
  // è§¦å‘åˆ›å»ºå˜é‡äº‹ä»¶
  emit('create-variable', varName);
  
  // å¯é€‰: æ˜¾ç¤ºåˆ›å»ºæˆåŠŸæç¤º
  window.$message?.success(
    t('contextMode.preview.variableCreated', { name: varName })
  );
  
  // å¯é€‰: å…³é—­é¢„è§ˆé¢æ¿
  // emit('update:show', false);
};
</script>

<style scoped>
.cursor-pointer {
  cursor: pointer;
}
</style>
```

**çˆ¶ç»„ä»¶å¤„ç†:**
```vue
<!-- App.vue æˆ– ContextUserWorkspace.vue -->
<PromptPreviewPanel
  @create-variable="handleQuickCreateVariable"
/>

<script setup lang="ts">
const handleQuickCreateVariable = async (varName: string) => {
  // æ–¹æ¡ˆ1: ç›´æ¥åˆ›å»ºä¼šè¯å˜é‡
  contextVariables.value[varName] = '';
  
  // æ–¹æ¡ˆ2: æ‰“å¼€å˜é‡ç®¡ç†å™¨å¹¶èšç„¦
  showVariableManager.value = true;
  await nextTick();
  focusVariable(varName);
  
  // æ–¹æ¡ˆ3: å¼¹å‡ºå¿«é€Ÿè¾“å…¥æ¡†
  const value = await showPrompt({
    title: t('variables.quickCreate'),
    message: t('variables.enterValue', { name: varName }),
    placeholder: t('variables.valuePlaceholder')
  });
  if (value) {
    contextVariables.value[varName] = value;
  }
};
</script>
```

---

#### æ”¹è¿› 4: å˜é‡æ¥æºå¯è§†åŒ–

**é—®é¢˜**: å½“å‰æ— æ³•ç›´è§‚åŒºåˆ†å˜é‡æ¥æºï¼ˆå…¨å±€/ä¼šè¯/å†…ç½®ï¼‰

**æ”¹è¿›æ–¹æ¡ˆ: å˜é‡è¾“å…¥è¡¨å•å¢å¼º**

**å®ç°ä»£ç :**
```vue
<!-- TestAreaPanel.vue - å˜é‡è¾“å…¥è¡¨å• -->
<template>
  <NSpace vertical :size="12">
    <div
      v-for="varName in detectedVariables"
      :key="varName"
      class="variable-input-row"
    >
      <!-- å˜é‡åæ ‡ç­¾ (å¸¦æ¥æºæ ‡è¯†) -->
      <NTag
        :size="tagSize"
        :type="getVariableSourceType(varName)"
        :bordered="false"
        :style="{ minWidth: '120px', flexShrink: 0 }"
      >
        <!-- æ¥æºå›¾æ ‡ -->
        <template #icon>
          <svg v-if="isPredefinedVariable(varName)" width="12" height="12">
            <!-- å†…ç½®å˜é‡å›¾æ ‡ (é½¿è½®) -->
            <path d="M10.325 4.317c.426-1.756..." fill="currentColor"/>
          </svg>
          <svg v-else-if="isContextVariable(varName)" width="12" height="12">
            <!-- ä¼šè¯å˜é‡å›¾æ ‡ (æ–‡æ¡£) -->
            <path d="M9 2H5a2 2 0 00-2 2v12..." fill="currentColor"/>
          </svg>
          <svg v-else-if="isGlobalVariable(varName)" width="12" height="12">
            <!-- å…¨å±€å˜é‡å›¾æ ‡ (åœ°çƒ) -->
            <circle cx="6" cy="6" r="5" stroke="currentColor"/>
          </svg>
        </template>
        
        <span v-text="`{{${varName}}}`"></span>
        
        <!-- æ¥æºæç¤º -->
        <NTooltip>
          <template #trigger>
            <NIcon :size="12" style="margin-left: 4px;">
              <svg viewBox="0 0 24 24">
                <path d="M12 22C6.477 22 2 17.523 2 12S6.477 2 12 2s10 4.477 10 10-4.477 10-10 10zm-1-11v6h2v-6h-2zm0-4v2h2V7h-2z"/>
              </svg>
            </NIcon>
          </template>
          <div class="variable-source-tooltip">
            <div>{{ $t('variables.source.label') }}: {{ getVariableSourceLabel(varName) }}</div>
            <div>{{ $t('variables.priority.label') }}: {{ getVariablePriority(varName) }}</div>
            <div v-if="getVariableValue(varName)" class="mt-1">
              {{ $t('variables.currentValue') }}: {{ getVariableValue(varName) }}
            </div>
          </div>
        </NTooltip>
      </NTag>
      
      <!-- å˜é‡å€¼è¾“å…¥ -->
      <NInput
        :value="getVariableDisplayValue(varName)"
        :placeholder="getVariablePlaceholder(varName)"
        :size="inputSize"
        :disabled="isPredefinedVariable(varName)"
        @update:value="handleVariableValueChange(varName, $event)"
      >
        <template v-if="!isPredefinedVariable(varName)" #suffix>
          <NButton
            text
            @click="handleClearVariable(varName)"
            :title="$t('common.clear')"
          >
            <template #icon>
              <svg width="14" height="14" viewBox="0 0 24 24">
                <path d="M6 18L18 6M6 6l12 12" stroke="currentColor"/>
              </svg>
            </template>
          </NButton>
        </template>
      </NInput>
    </div>
  </NSpace>
</template>

<script setup lang="ts">
import { computed } from 'vue';

const getVariableSourceType = (varName: string) => {
  if (props.predefinedVariables[varName] !== undefined) return 'info';      // å†…ç½® - è“è‰²
  if (props.contextVariables[varName] !== undefined) return 'success';      // ä¼šè¯ - ç»¿è‰²
  if (props.globalVariables[varName] !== undefined) return 'warning';       // å…¨å±€ - æ©™è‰²
  return 'default';                                                         // æœªå®šä¹‰ - ç°è‰²
};

const getVariableSourceLabel = (varName: string) => {
  if (props.predefinedVariables[varName] !== undefined) return t('variables.source.predefined');
  if (props.contextVariables[varName] !== undefined) return t('variables.source.context');
  if (props.globalVariables[varName] !== undefined) return t('variables.source.global');
  return t('variables.source.missing');
};

const getVariablePriority = (varName: string) => {
  if (props.predefinedVariables[varName] !== undefined) return t('variables.priority.highest');
  if (props.contextVariables[varName] !== undefined) return t('variables.priority.medium');
  if (props.globalVariables[varName] !== undefined) return t('variables.priority.lowest');
  return '-';
};

const isPredefinedVariable = (varName: string) => {
  return props.predefinedVariables[varName] !== undefined;
};

const isContextVariable = (varName: string) => {
  return props.contextVariables[varName] !== undefined && 
         props.predefinedVariables[varName] === undefined;
};

const isGlobalVariable = (varName: string) => {
  return props.globalVariables[varName] !== undefined && 
         props.contextVariables[varName] === undefined &&
         props.predefinedVariables[varName] === undefined;
};
</script>

<style scoped>
.variable-input-row {
  display: flex;
  align-items: center;
  gap: 8px;
}

.variable-source-tooltip {
  font-size: 13px;
  line-height: 1.6;
}

.mt-1 {
  margin-top: 4px;
}
</style>
```

**è§†è§‰æ•ˆæœ:**
```
ğŸ”§ {{originalPrompt}}      [å†…ç½® - è“è‰²æ ‡ç­¾] (ä¸å¯ç¼–è¾‘)
ğŸ“„ {{style}}               [ä¼šè¯ - ç»¿è‰²æ ‡ç­¾] [æ¬¢å¿«_____] [Ã—]
ğŸŒ {{tone}}                [å…¨å±€ - æ©™è‰²æ ‡ç­¾] [æ­£å¼_____] [Ã—]
âš ï¸ {{genre}}               [ç¼ºå¤± - ç°è‰²æ ‡ç­¾] [_________] [Ã—]

é¼ æ ‡æ‚¬åœæ˜¾ç¤º:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ¥æº: ä¼šè¯å˜é‡      â”‚
â”‚ ä¼˜å…ˆçº§: ä¸­          â”‚
â”‚ å½“å‰å€¼: æ¬¢å¿«        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

#### æ”¹è¿› 5: å˜é‡å†å²è®°å½•å’Œæ™ºèƒ½å»ºè®®

**åŠŸèƒ½æè¿°**: è®°å½•ç”¨æˆ·è¾“å…¥çš„å˜é‡å€¼å†å²ï¼Œæä¾›æ™ºèƒ½å»ºè®®

**å®ç°ä»£ç :**
```vue
<!-- TestAreaPanel.vue -->
<template>
  <NAutoComplete
    v-model="variableValues[varName]"
    :options="getVariableHistorySuggestions(varName)"
    :placeholder="getSmartPlaceholder(varName)"
    :size="inputSize"
    @update:value="handleVariableValueChange(varName, $event)"
  />
</template>

<script setup lang="ts">
import { ref, computed } from 'vue';
import type { AutoCompleteOption } from 'naive-ui';

// å˜é‡å†å²è®°å½•å­˜å‚¨ (localStorage)
const VARIABLE_HISTORY_KEY = 'prompt-optimizer:variable-history';

const variableHistory = ref<Record<string, string[]>>({});

// åŠ è½½å†å²è®°å½•
onMounted(() => {
  try {
    const stored = localStorage.getItem(VARIABLE_HISTORY_KEY);
    if (stored) {
      variableHistory.value = JSON.parse(stored);
    }
  } catch (error) {
    console.error('Failed to load variable history:', error);
  }
});

// ä¿å­˜å†å²è®°å½•
const saveVariableHistory = (varName: string, value: string) => {
  if (!value || value.trim() === '') return;
  
  // è·å–å½“å‰å˜é‡çš„å†å²è®°å½•
  const history = variableHistory.value[varName] || [];
  
  // å»é‡å¹¶æ·»åŠ åˆ°å¼€å¤´
  const filtered = history.filter(v => v !== value);
  const updated = [value, ...filtered].slice(0, 10); // æœ€å¤šä¿ç•™10æ¡
  
  // æ›´æ–°è®°å½•
  variableHistory.value[varName] = updated;
  
  // æŒä¹…åŒ–
  try {
    localStorage.setItem(
      VARIABLE_HISTORY_KEY,
      JSON.stringify(variableHistory.value)
    );
  } catch (error) {
    console.error('Failed to save variable history:', error);
  }
};

// è·å–å˜é‡å†å²å»ºè®®
const getVariableHistorySuggestions = (varName: string): AutoCompleteOption[] => {
  const history = variableHistory.value[varName] || [];
  
  return history.map((value, index) => ({
    label: value,
    value: value,
    // æ˜¾ç¤ºä½¿ç”¨é¢‘ç‡
    extra: index === 0 ? t('variables.history.recent') : undefined
  }));
};

// æ™ºèƒ½å ä½ç¬¦
const getSmartPlaceholder = (varName: string): string => {
  // 1. æ£€æŸ¥æ˜¯å¦æœ‰å†å²è®°å½•
  const history = variableHistory.value[varName];
  if (history && history.length > 0) {
    return t('variables.placeholder.withHistory', { example: history[0] });
  }
  
  // 2. æ ¹æ®å˜é‡åæ¨æµ‹ç±»å‹
  if (varName.includes('style') || varName.includes('é£æ ¼')) {
    return t('variables.placeholder.style'); // "å¦‚ï¼šæµè¡Œã€æ‘‡æ»šã€æ°‘è°£..."
  }
  if (varName.includes('tone') || varName.includes('è¯­æ°”')) {
    return t('variables.placeholder.tone'); // "å¦‚ï¼šæ­£å¼ã€è½»æ¾ã€å¹½é»˜..."
  }
  if (varName.includes('language') || varName.includes('è¯­è¨€')) {
    return t('variables.placeholder.language'); // "å¦‚ï¼šä¸­æ–‡ã€è‹±æ–‡ã€æ—¥è¯­..."
  }
  
  // 3. é»˜è®¤å ä½ç¬¦
  return t('variables.placeholder.default'); // "è¯·è¾“å…¥å˜é‡å€¼"
};

// å¤„ç†å˜é‡å€¼å˜åŒ–
const handleVariableValueChange = (varName: string, value: string) => {
  // ä¿å­˜åˆ°å†å²è®°å½•
  saveVariableHistory(varName, value);
  
  // è§¦å‘æ›´æ–°äº‹ä»¶
  emit('variable-change', varName, value);
};
</script>
```

**ç”¨æˆ·ä½“éªŒ:**
```
è¾“å…¥æ¡†è·å¾—ç„¦ç‚¹æ—¶:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ {{style}}               â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ æ¬¢å¿« (æœ€è¿‘ä½¿ç”¨)     â†“â”‚ â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚ â”‚ æµè¡Œ                â”‚ â”‚
â”‚ â”‚ æ‘‡æ»š                â”‚ â”‚
â”‚ â”‚ æ°‘è°£                â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ™ºèƒ½å ä½ç¬¦:
- æœ‰å†å²: "ä¸Šæ¬¡è¾“å…¥ï¼šæ¬¢å¿«"
- æ— å†å²: "å¦‚ï¼šæµè¡Œã€æ‘‡æ»šã€æ°‘è°£..."
```

---

## ä¸ƒã€ä¸è®¾è®¡æ–‡æ¡£å¯¹æ¯”

### âœ… å·²å®ç°çš„è®¾è®¡

| è®¾è®¡æ–‡æ¡£è¦æ±‚ | å®ç°çŠ¶æ€ | ä»£ç ä½ç½® | å¤‡æ³¨ |
|-------------|---------|---------|------|
| ç”¨æˆ·æ¨¡å¼éšè—ä¼šè¯ç®¡ç† | âœ… | `ContextUserWorkspace.vue` | æ—  ConversationManager ç»„ä»¶ |
| ç³»ç»Ÿæ¨¡å¼æ˜¾ç¤ºä¼šè¯ç®¡ç† | âœ… | `ContextSystemWorkspace.vue` | åŒ…å« ConversationManager |
| ä¸‰å±‚å˜é‡å¿«æ·æŒ‰é’® | âœ… | `ContextModeActions.vue` | å…¨å±€/ä¼šè¯å˜é‡æŒ‰é’® |
| å®æ—¶é¢„è§ˆé¢æ¿ | âœ… | `PromptPreviewPanel.vue` | æ”¯æŒå˜é‡æ›¿æ¢é¢„è§ˆ |
| å˜é‡ç»Ÿè®¡å±•ç¤º | âœ… | `usePromptPreview.ts:123` | `variableStats` è®¡ç®—å±æ€§ |
| ç¼ºå¤±å˜é‡è­¦å‘Š | âœ… | `PromptPreviewPanel.vue:32` | é«˜äº®æ˜¾ç¤ºç¼ºå¤±å˜é‡ |
| æ¨¡å¼è¯´æ˜æç¤º | âœ… | `PromptPreviewPanel.vue:48` | åŠ¨æ€æ¨¡å¼è¯´æ˜ |
| é˜²æŠ–ä¼˜åŒ– | âœ… | `ConversationManager.vue:187` | 150ms é˜²æŠ– |
| æ‰¹å¤„ç†æ›´æ–° | âœ… | `ConversationManager.vue:195` | 16ms æ‰¹å¤„ç† |
| å›½é™…åŒ–æ”¯æŒ | âœ… | æ‰€æœ‰ç»„ä»¶ | å®Œæ•´ i18n è¦†ç›– |
| å¯è®¿é—®æ€§ | âœ… | æ‰€æœ‰ç»„ä»¶ | å®Œæ•´ aria å±æ€§ |

### âš ï¸ ä¸æ–‡æ¡£ä¸ä¸€è‡´

| è®¾è®¡æ–‡æ¡£ | å®é™…å®ç° | å·®å¼‚è¯´æ˜ | å»ºè®® |
|---------|---------|---------|------|
| "å·¥å…·ç®¡ç† - ä¸¤ç§æ¨¡å¼éƒ½æ˜¾ç¤º" | ä»…ç”¨æˆ·æ¨¡å¼æ˜¾ç¤º (`v-if="user"`) | æ–‡æ¡£è¿‡æœŸæˆ–è®¾è®¡å˜æ›´ | ç»Ÿä¸€ä¸º"ä»…ç”¨æˆ·æ¨¡å¼" |
| "å˜é‡æ¥æºæ ‡æ³¨ (å…¨å±€/ä¼šè¯/å†…ç½®)" | UI æœªæ˜¾ç¤ºæ¥æºæ ‡è¯† | åŠŸèƒ½æœªå®ç° | æ·»åŠ  `VariableSourceBadge` |
| "å¿«é€Ÿæ·»åŠ å˜é‡æŒ‰é’®" | ä»…æç¤ºæ— å¿«é€Ÿæ“ä½œ | äº¤äº’æœªå®Œå–„ | å®ç°ç‚¹å‡»åˆ›å»ºå˜é‡ |

### ğŸ“ å»ºè®®æ›´æ–°çš„æ–‡æ¡£

**è®¾è®¡æ–‡æ¡£éœ€è¦æ›´æ–°çš„éƒ¨åˆ†:**

1. **`design.md` - ç»„ä»¶è®¾è®¡ç« èŠ‚**
   ```diff
   - å·¥å…·ç®¡ç† - ä¸¤ç§æ¨¡å¼éƒ½æ˜¾ç¤º
   + å·¥å…·ç®¡ç† - ä»…ç”¨æˆ·æ¨¡å¼æ˜¾ç¤º (ç³»ç»Ÿæ¨¡å¼é€šè¿‡ä¸Šä¸‹æ–‡ç¼–è¾‘å™¨ç®¡ç†)
   ```

2. **`design.md` - å˜é‡ç®¡ç† UI**
   ```diff
   + #### å˜é‡æ¥æºå¯è§†åŒ–
   + 
   + å˜é‡è¾“å…¥è¡¨å•åº”æ˜¾ç¤ºå˜é‡æ¥æºæ ‡è¯†:
   + - ğŸ”§ å†…ç½®å˜é‡ (è“è‰²æ ‡ç­¾ï¼Œä¸å¯ç¼–è¾‘)
   + - ğŸ“„ ä¼šè¯å˜é‡ (ç»¿è‰²æ ‡ç­¾)
   + - ğŸŒ å…¨å±€å˜é‡ (æ©™è‰²æ ‡ç­¾)
   + - âš ï¸ æœªå®šä¹‰å˜é‡ (ç°è‰²æ ‡ç­¾)
   ```

3. **`tasks.md` - æ–°å¢å¾…å®Œæˆä»»åŠ¡**
   ```markdown
   - [ ] 19. UI ç»†èŠ‚ä¼˜åŒ–
     - **Files**:
       - `packages/ui/src/components/context-mode/ConversationManager.vue`
       - `packages/ui/src/components/PromptPreviewPanel.vue`
       - `packages/ui/src/components/TestAreaPanel.vue`
     - **Description**:
       - ä¼šè¯ç®¡ç†å™¨å±•å¼€/æŠ˜å ç¼–è¾‘åŠŸèƒ½
       - é¢„è§ˆé¢æ¿å¿«é€Ÿåˆ›å»ºå˜é‡æŒ‰é’®
       - æµ‹è¯•åŒºåŸŸå˜é‡æ¥æºå¯è§†åŒ–
       - å˜é‡å†å²è®°å½•å’Œæ™ºèƒ½å»ºè®®
     - **Requirements**: éœ€æ±‚4 (æ˜“ç”¨æ€§æå‡)
     - **Success Criteria**:
       - âœ… é•¿æ¶ˆæ¯å¯å±•å¼€ç¼–è¾‘
       - âœ… ç¼ºå¤±å˜é‡ç‚¹å‡»åˆ›å»º
       - âœ… å˜é‡æ¥æºæ¸…æ™°æ ‡è¯†
       - âœ… å†å²è®°å½•æ™ºèƒ½å»ºè®®
   ```

---

## å…«ã€æ€»ä½“è¯„ä»·

### ğŸ¯ è®¾è®¡è´¨é‡è¯„åˆ†

| ç»´åº¦ | è¯„åˆ† | è¯´æ˜ | å¾…æ”¹è¿›ç‚¹ |
|------|------|------|---------|
| **æ¶æ„è®¾è®¡** | â­â­â­â­â­ | ç»„ä»¶åˆ†ç¦»æ¸…æ™°ï¼Œæ¨¡å¼åŒ–è®¾è®¡ä¼˜ç§€ | - |
| **ä»£ç è´¨é‡** | â­â­â­â­â˜† | TypeScript ç±»å‹å®Œå–„ï¼Œé˜²æŠ–ä¼˜åŒ–åˆ°ä½ | éƒ¨åˆ†ç±»å‹å¯ä»¥æ›´ä¸¥æ ¼ |
| **ç”¨æˆ·ä½“éªŒ** | â­â­â­â­â˜† | å®æ—¶é¢„è§ˆã€ç»Ÿè®¡ä¿¡æ¯æ¸…æ™° | ç¼ºå°‘å¿«æ·æ“ä½œã€å˜é‡æ¥æºä¸æ˜ç¡® |
| **å¯è®¿é—®æ€§** | â­â­â­â­â­ | å®Œæ•´çš„ aria å±æ€§ï¼Œé”®ç›˜å¯¼èˆªæ”¯æŒ | - |
| **å›½é™…åŒ–** | â­â­â­â­â­ | å…¨é¢ä½¿ç”¨ i18n | - |
| **æ€§èƒ½ä¼˜åŒ–** | â­â­â­â­â˜† | é˜²æŠ–/æ‰¹å¤„ç†åˆ°ä½ | å¯è€ƒè™‘è™šæ‹Ÿæ»šåŠ¨ |
| **æ–‡æ¡£ä¸€è‡´æ€§** | â­â­â­â˜†â˜† | éƒ¨åˆ†å®ç°ä¸æ–‡æ¡£ä¸ä¸€è‡´ | éœ€åŒæ­¥æ›´æ–°æ–‡æ¡£ |

**æ€»ä½“è¯„åˆ†: 4.6/5.0** â­â­â­â­â­

### ğŸ’ª æ ¸å¿ƒä¼˜åŠ¿

1. **æ¨¡å¼åŒ–è®¾è®¡æ¸…æ™°** - User/System ç»„ä»¶å®Œå…¨åˆ†ç¦»ï¼Œé¿å…æ¡ä»¶åˆ¤æ–­åœ°ç‹±
2. **æ€§èƒ½ä¼˜åŒ–åˆ°ä½** - é˜²æŠ–ã€æ‰¹å¤„ç†ã€æµ…æ‹·è´ç­‰ä¼˜åŒ–æªæ–½å®Œå–„
3. **ç±»å‹å®‰å…¨å®Œæ•´** - TypeScript ç±»å‹å®šä¹‰ä¸¥æ ¼ï¼Œemit ç±»å‹å®Œæ•´
4. **å¯è®¿é—®æ€§ä¼˜ç§€** - å®Œæ•´çš„ aria å±æ€§å’Œé”®ç›˜å¯¼èˆªæ”¯æŒ
5. **Naive UI ä¸€è‡´æ€§** - ç»Ÿä¸€ä½¿ç”¨ Naive UI ç»„ä»¶ï¼Œä¸»é¢˜é€‚é…è‰¯å¥½

### ğŸ”§ æ”¹è¿›ç©ºé—´

1. **æ–‡æ¡£åŒæ­¥** - è®¾è®¡æ–‡æ¡£ä¸å®ç°å­˜åœ¨éƒ¨åˆ†ä¸ä¸€è‡´ï¼Œéœ€è¦ç»Ÿä¸€
2. **å¿«æ·äº¤äº’** - ç¼ºå¤±å˜é‡å¿«é€Ÿåˆ›å»ºã€ä¼šè¯æ¶ˆæ¯å±•å¼€ç¼–è¾‘ç­‰ç»†èŠ‚äº¤äº’å¾…å®Œå–„
3. **å˜é‡å¯è§†åŒ–** - å˜é‡æ¥æºï¼ˆå…¨å±€/ä¼šè¯/å†…ç½®ï¼‰æœªåœ¨ UI æ¸…æ™°æ ‡è¯†
4. **æ™ºèƒ½å»ºè®®** - å˜é‡å†å²è®°å½•ã€æ™ºèƒ½å ä½ç¬¦ç­‰ AI è¾…åŠ©åŠŸèƒ½å¯å¢å¼º

---

## ä¹ã€ä¸‹ä¸€æ­¥è¡ŒåŠ¨è®¡åˆ’

### ğŸš€ çŸ­æœŸä¼˜åŒ– (1-2 å‘¨)

**ä¼˜å…ˆçº§ P1 - å¿…é¡»ä¿®å¤:**
1. âœ… ç»Ÿä¸€å·¥å…·ç®¡ç†æŒ‰é’®æ˜¾ç¤ºé€»è¾‘ï¼ˆä»£ç æˆ–æ–‡æ¡£ï¼‰
2. âœ… æ›´æ–° `design.md` å’Œ `tasks.md` ä½¿å…¶ä¸å®ç°ä¸€è‡´

**ä¼˜å…ˆçº§ P2 - é‡è¦æ”¹è¿›:**
1. âœ… å®ç°ç¼ºå¤±å˜é‡å¿«é€Ÿåˆ›å»ºåŠŸèƒ½
2. âœ… ä¼˜åŒ–ä¼šè¯ç®¡ç†å™¨ç¼–è¾‘ä½“éªŒï¼ˆå±•å¼€/æŠ˜å ï¼‰
3. âœ… æ·»åŠ å˜é‡æ¥æºæ ‡æ³¨ UI

### ğŸ“ˆ ä¸­æœŸä¼˜åŒ– (1 ä¸ªæœˆ)

1. âœ… å®ç°å˜é‡å†å²è®°å½•å’Œæ™ºèƒ½å»ºè®®
2. âœ… æ·»åŠ é¢„è§ˆä¸å®é™…æ¸²æŸ“ä¸€è‡´æ€§æ£€æŸ¥
3. âœ… ä¼˜åŒ–ç§»åŠ¨ç«¯å“åº”å¼å¸ƒå±€
4. âœ… å®Œå–„æ— éšœç¢æµ‹è¯•ï¼ˆè‡ªåŠ¨åŒ– a11y æµ‹è¯•ï¼‰

### ğŸ¯ é•¿æœŸä¼˜åŒ– (å­£åº¦çº§)

1. âœ… å®ç°ååŒç¼–è¾‘ï¼ˆå¤šäººåŒæ—¶ç¼–è¾‘ä¸Šä¸‹æ–‡ï¼‰
2. âœ… æ·»åŠ å¯è§†åŒ–å˜é‡ä¾èµ–å›¾è°±
3. âœ… æä¾›æ¨¡æ¿å¸‚åœºï¼ˆåˆ†äº«ä¼˜ç§€ä¸Šä¸‹æ–‡é…ç½®ï¼‰
4. âœ… AI è¾…åŠ©å˜é‡æ¨èï¼ˆæ ¹æ®æç¤ºè¯å†…å®¹æ™ºèƒ½æ¨èå˜é‡åå’Œå€¼ï¼‰

---

## åã€é™„å½•

### A. ç»„ä»¶æ–‡ä»¶æ¸…å•

```
packages/ui/src/components/
â”œâ”€â”€ context-mode/
â”‚   â”œâ”€â”€ ContextUserWorkspace.vue       (240 è¡Œ)
â”‚   â”œâ”€â”€ ContextSystemWorkspace.vue     (280 è¡Œ)
â”‚   â”œâ”€â”€ ContextModeActions.vue         (50 è¡Œ)
â”‚   â”œâ”€â”€ ContextEditor.vue              (844+ è¡Œ)
â”‚   â””â”€â”€ ConversationManager.vue        (520 è¡Œ)
â”œâ”€â”€ PromptPreviewPanel.vue             (120 è¡Œ)
â”œâ”€â”€ TestAreaPanel.vue                  (100+ è¡Œ)
â”œâ”€â”€ InputPanel.vue                     (150+ è¡Œ)
â””â”€â”€ PromptPanel.vue                    (200+ è¡Œ)

packages/ui/src/composables/
â””â”€â”€ usePromptPreview.ts                (180 è¡Œ)
```

### B. å…³é”®å¸¸é‡å®šä¹‰

```typescript
// å†…ç½®é¢„å®šä¹‰å˜é‡
const PREDEFINED_VARIABLES = [
  'originalPrompt',
  'lastOptimizedPrompt',
  'iterateInput',
  'currentPrompt',
  'userQuestion',
  'conversationContext',
  'toolsContext'
];

// å˜é‡æ¥æºç±»å‹
type VariableSource = 'predefined' | 'context' | 'global' | 'missing';

// ä¸Šä¸‹æ–‡æ¨¡å¼
type ContextMode = 'user' | 'system';

// æ¸²æŸ“é˜¶æ®µ
type RenderPhase = 'optimize' | 'test';
```

### C. å›½é™…åŒ– Keys æ¸…å•

```typescript
// éœ€è¦è¡¥å……çš„ i18n keys
const I18N_KEYS = {
  contextMode: {
    actions: {
      globalVariables: 'å…¨å±€å˜é‡',
      contextVariables: 'ä¼šè¯å˜é‡',
      tools: 'å·¥å…·ç®¡ç†'
    },
    preview: {
      title: 'é¢„è§ˆ',
      stats: 'å˜é‡ç»Ÿè®¡',
      totalVars: 'å˜é‡æ€»æ•°',
      providedVars: 'å·²æä¾›',
      missingVars: 'ç¼ºå¤±',
      clickToCreateVariableHint: 'ç‚¹å‡»å˜é‡æ ‡ç­¾å¿«é€Ÿåˆ›å»º'
    }
  },
  variables: {
    source: {
      predefined: 'å†…ç½®å˜é‡',
      context: 'ä¼šè¯å˜é‡',
      global: 'å…¨å±€å˜é‡',
      missing: 'æœªå®šä¹‰'
    },
    priority: {
      highest: 'æœ€é«˜',
      medium: 'ä¸­',
      lowest: 'æœ€ä½'
    },
    placeholder: {
      style: 'å¦‚ï¼šæµè¡Œã€æ‘‡æ»šã€æ°‘è°£...',
      tone: 'å¦‚ï¼šæ­£å¼ã€è½»æ¾ã€å¹½é»˜...',
      language: 'å¦‚ï¼šä¸­æ–‡ã€è‹±æ–‡ã€æ—¥è¯­...',
      default: 'è¯·è¾“å…¥å˜é‡å€¼'
    }
  }
};
```

### D. æ€§èƒ½åŸºå‡†å‚è€ƒ

```typescript
// æ€§èƒ½ç›®æ ‡
const PERFORMANCE_TARGETS = {
  variableMerge: 5,        // å˜é‡åˆå¹¶ < 5ms
  previewRender: 50,       // é¢„è§ˆæ¸²æŸ“ < 50ms
  messageUpdate: 150,      // æ¶ˆæ¯æ›´æ–°é˜²æŠ– 150ms
  batchUpdate: 16,         // æ‰¹å¤„ç† 16ms (60fps)
  maxVariables: 100,       // æœ€å¤§å˜é‡æ•°
  maxMessages: 50          // æœ€å¤§æ¶ˆæ¯æ•°
};
```

---

## ç»“è®º

è¿™æ˜¯ä¸€ä¸ª**è®¾è®¡éå¸¸ä¼˜ç§€çš„ UI ç³»ç»Ÿ**ï¼Œæ ¸å¿ƒæ¶æ„æ¸…æ™°ï¼Œæ€§èƒ½ä¼˜åŒ–åˆ°ä½ï¼Œç”¨æˆ·ä½“éªŒè‰¯å¥½ã€‚ä¸»è¦æ”¹è¿›ç©ºé—´åœ¨äº:

1. **æ–‡æ¡£ä¸€è‡´æ€§** - åŒæ­¥è®¾è®¡æ–‡æ¡£å’Œå®ç°ä»£ç 
2. **ç»†èŠ‚äº¤äº’** - å¿«æ·æ“ä½œã€å˜é‡æ¥æºå¯è§†åŒ–ç­‰
3. **æ™ºèƒ½è¾…åŠ©** - å†å²è®°å½•ã€æ™ºèƒ½å»ºè®®ç­‰ AI å¢å¼ºåŠŸèƒ½

é€šè¿‡å®æ–½æœ¬æŠ¥å‘Šæå‡ºçš„æ”¹è¿›å»ºè®®ï¼Œå¯ä»¥å°† UI è´¨é‡ä» 4.6/5.0 æå‡è‡³ 4.9/5.0 â­â­â­â­â­

---

**æ–‡æ¡£ç»´æŠ¤:**
- æœ€åæ›´æ–°: 2025-10-21
- ä¸‹æ¬¡å®¡æŸ¥: å®ç°æ”¹è¿›å»ºè®®å
- è´Ÿè´£äºº: UI å›¢é˜Ÿ
